---
title: "Lääkkeiden tilastoja"
output: 
  flexdashboard::flex_dashboard:
    orientation: rows
    vertical_layout: fill
---

```{r setup, include=FALSE}
library(flexdashboard)
library(tidyverse)
library(data.table)
pakkaus1<-read_delim(paste0(getwd(),"/Aineisto/pakkaus1.txt"),";")
```
Perustiedot
===================================== 
Row {data-width=650}
-----------------------------------------------------------------------

### Perustietoa

```{r}
#Lasketaan eri lääkepakkausten, vnr- ja atc-luokkien määrä
maarat <- pakkaus1 %>% summarise(pakkauksia = n_distinct(PAKKAUSNRO),
                                 vnrnumeroita = n_distinct(VNRNRO),
                                 atcluokkia = n_distinct(ATCKOODI),
                                 lääkenimiä = n_distinct(LAAKENIMI),
                                 myyntilupanumeroita = n_distinct(MYYNTILUPANRO),
                                 EU_myyntilupanumeroita = n_distinct(EUMYYNTILUPANRO),
                                 haltijoita = n_distinct(HALTIJA),
                                 huumausainelääkkeitä = sum(HUUME == "H",na.rm = T),
                                 liikennevaarallisia = sum(LIIKENNEVAARA))
#####SEuraavaksi osuudet

osuudet <- pakkaus1 %>% summarise(vnr_osuus= round(sum(!is.na(VNRNRO))/sum(!is.na(PAKKAUSNRO))*100,1), 
                                 atc_osuus= round(sum(!is.na(ATCKOODI))/sum(!is.na(PAKKAUSNRO))*100,1),
                                 lääkenimet_osuus = round(sum(!is.na(LAAKENIMI))/sum(!is.na(PAKKAUSNRO))*100,1),
                                 myyntilupanumeroiden_osuus = round(sum(!is.na(MYYNTILUPANRO))/sum(!is.na(PAKKAUSNRO))*100,1),
                                 EU_myyntilupanumeroiden_osuus =                              round(sum(!is.na(EUMYYNTILUPANRO))/sum(!is.na(PAKKAUSNRO))*100,1),
                                 huumausainelääkkeiden_osuus = 
                 round(sum(HUUME == "H",na.rm = T)/sum(!is.na(PAKKAUSNRO))*100,1),
                  liikennevaarallisten_osuus = 
                 round(sum(LIIKENNEVAARA)/sum(!is.na(PAKKAUSNRO))*100,1))

#sitten vuodet
vuodet <- pakkaus1 %>% mutate(vuodet = format(KAUPPAANTULOPVM, format = "%Y")) %>% group_by(vuodet) %>%  summarise(määrät_lääkepakkaus =n(),määrät_vnr = n_distinct(VNRNRO) )

knitr::kable(maarat)
knitr::kable(osuudet)
knitr::kable(vuodet)

```
Row {data-width=650}
-----------------------------------------------------------------------
### Perustietojen kuvaaja
```{r}
m<-gather(maarat,muuttuja,arvo,pakkauksia:liikennevaarallisia,factor_key = T)

ggplot(m,aes(x=muuttuja,y = arvo))+geom_bar(stat="identity")+coord_flip()
```

ATC-luokat
====================
Row {data-width=350}
-----------------------------------------------------------------------

### Chart B

```{r}

```

### Chart C

```{r}

```
Raakadata
==================
```{r}
data.table(pakkaus1)
```

